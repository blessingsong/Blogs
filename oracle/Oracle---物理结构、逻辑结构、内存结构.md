---
title: Oracle---物理结构、逻辑结构、内存结构
tags: Oracle,物理结构,逻辑结构,内存结构
grammar_cjkRuby: true
---

* [逻辑结构](#逻辑结构)
	* [存储关系](#存储关系)
		* [存储结构](#存储结构)
		* [如何存储表数据](#如何存储表数据)
	* [表空间（tablespace）](#表空间tablespace)
		* [常用表空间](#常用表空间)
		* [表空间和数据文件的关系](#表空间和数据文件的关系)
	* [段（Segment）](#段segment)
	* [数据区（Extent）](#数据区extent)
	* [数据块（Data Blocks）](#数据块data-blocks)
* [物理结构](#物理结构)
	* [数据文件](#数据文件)
	* [日志文件](#日志文件)
	* [控制文件](#控制文件)
	* [参数文件](#参数文件)
* [实例（instance）](#实例instance)

Oracle系统体系结构由三部分组成：逻辑结构、物理结构和实例。

![enter description here][1]

# 逻辑结构
Oracle的逻辑结构是一种层次结构。主要由：表空间、段、区和数据块等概念组成。逻辑结构是面向用户的，用户使用Oracle开发应用程序使用的就是逻辑结构。数据库存储层次结构及其构成关系,结构对象也从数据块到表空间形成了不同层次的粒度关系。

![逻辑结构][2]
## 存储关系
Oracle 数据库逻辑上是由一个或多个表空间组成的，表空间物理上是由一个或多个数据 文件组成的；而在逻辑上表空间又是由一个或多个段组成的。在Oracle 数据库中，通过为 每种不同的数据对象分配不同的段，来保存数据。例如EMP 表的所有数据会存放在EMP 段中。在Oracle 数据库中，段是由一个或多个区组成的，而区又是由连续存储的数据块所 组成的。块则是数据库的I/O 最小的单位。
### 存储结构

![enter description here][3]

数据库可划分为被称为表空间的逻辑存储单元。每一个表空间可以包含很多的Oracle 逻辑数据块。DB_BLOCK_SIZE 参数指定了逻辑块的大小。逻辑块的大小范围为2 KB 至 32 KB，默认大小为8 KB。特定数目的相邻逻辑块构成了一个区。为特定逻辑结构分配 的一组区构成了一个段。Oracle 数据块是逻辑I/O 的最小单位。
### 如何存储表数据
创建表时，就会创建段来保存表数据。表空间包含一组段。从逻辑上讲，表包含由列值 组成的行。行最终将以行片段的形式存储在数据库块中。之所以称为行片段，是因为某些情 况下，不可以在一个位置存储一整行。当插入行由于太长而不适合单个块时，或者由于更 新而导致现有行大小超出了行的当前空间时，就会发生这种情况。

![enter description here][4]

## 表空间（tablespace）
Oracle 数据库（tablespace）是由若干个表空间构成的。任何数据库对象在存储时都必 须存储在某个表空间中。表空间对应于若干个磁盘文件，即表空间是由一个或多个磁盘文件 构成的。表空间相当于操作系统中的文件夹，也是数据库逻辑结构与物理文件之间的一个映 射。每个数据库至少有一个表空间，表空间的大小等于所有从属于它的数据文件大小的总和。

### 常用表空间

 1. 系统表空间
 2. SYSAUX 表空间
 3. 临时表空间
 4. 撤销表空间
 5. USERS表空间
### 表空间和数据文件的关系

![enter description here][5]

 - Oracle 数据库由一个或多个称为表空间的逻辑存储单元组成， 表空间作为一个整体存储数据库中的所有数据，并且一个表空
   间只能属于一个数据库。数据库的大小是该数   据库中所表空间 大小总和。
 - 从物理讲，Oracle 数据库内的每个表空间由一个或多数据文件 组成，并且一个数据文件只能属于一个表空间。表空间大是所有数据文件大小的总
   和。这些数据文件与Oracle 运行所在的操作系统的文件有一样的物理结构。
 - 数据库的所有数据都存储在数据文件中，数据库的每个表空间都由这些数据文件组 成。例如，最简单的Oracle
   数据库只有一个表空间和一个数据文件。

## 段（Segment）
段是由多个数据区构成的，它是为特定的数据库对象（如表段、索引段、回滚段、临时段）分配的一系列数据区。段内包含的数据区可以不连续，并且可以跨越多个文件。使用段的目的是用来保存特定对象。 

一个Oracle数据库有4种类型的段： 

 - 数据段：数据段也称为表段，它包含数据并且与表和簇相关。当创建一个表时，系统自动创建一个以该表的名字命名的数据段。
 - 索引段：包含了用于提高系统性能的索引。一旦建立索引，系统自动创建一个以该索引的名字命名的索引段。
 - 回滚段：包含了回滚信息，并在数据库恢复期间使用，以便为数据库提供读入一致性和回滚未提交的事务，即用来回滚事务的数据空间。当一个事务开始处理时，系统为之分配回滚段，回滚段可以动态创建和撤销。系统有个默认的回滚段，其管理方式既可以是自动的，也可以是手工的。
 - 临时段：它是Oracle在运行过程中自行创建的段。当一个SQL语句需要临时工作区时，由Oracle建立临时段。一旦语句执行完毕，临时段的区间便退回给系统。


## 数据区（Extent）
数据区是一组连续的数据块。**当一个表、回滚段或临时段创建或需要附加空间时，系统总是为之分配一个新的数据区**。一个数据区不能跨越多个文件，因为它包含连续的数据块。使用区的目的是用来保存特定数据类型的数据，也是表中**数据增长的基本单位**。在Oracle数据库中，分配空间就是以数据区为单位的。一个Oracle对象包含至少一个数据区。设置一个表或索引的存储参数包含设置它的数据区大小。

## 数据块（Data Blocks）
数据块是Oracle最小的存储单位，Oracle数据存放在“块”中。一个块占用一定的磁盘空间。特别注意的是，这里的“块”是Oracle的“数据块”，不是操作系统的“块”。

Oracle每次请求数据的时候，都是以块为单位。也就是说，Oracle每次请求的数据是块的整数倍。如果Oracle请求的数据量不到一块，Oracle也会读取整个块。所以说，“块”是Oracle读写数据的最小单位或者最基本的单位。

块的标准大小由初始化参数DB_BLOCK_SIZE指定。具有标准大小的块称为标准块(Standard Block)。块的大小和标准块的大小不同的块叫非标准块(Nonstandard Block)。


# 物理结构
Oracle物理结构由多种物理文件组成。

![enter description here][6]

## 数据文件

每一个ORACLE数据库有一个或多个物理的数据文件(data file)。一个数据库的数据文件包含全部数据库数据。逻辑数据库结构(如表、索引)的数据物理地存储在数据库的数据文件中。数据文件有下列特征： 
一个数据文件仅与一个数据库联系。

一旦建立，数据文件不能改变大小.

一个表空间（数据库存储的逻辑单位）由一个或多个数据文件组成。 
数据文件中的数据在需要时可以读取并存储在ORACLE内存储区中。

## 日志文件
每一个数据库有两个或多个日志文件（redo log file）的组，每一个日志文件组用于收集数据库日志。日志的主要功能是记录对数据所作的修改，所以对数据库作的全部修改是记录在日志中。在出现故障时，如果不能将修改数据永久地写入数据文件，则可利用日志得到该修改，所以从不会丢失已有操作成果。 
日志文件主要是保护数据库以防止故障。为了防止日志文件本身的故障，ORACLE允许镜象日志(mirrored redo log)，以致可在不同磁盘上维护两个或多个日志副本。 
日志文件中的信息仅在系统故障或介质故障恢复数据库时使用，这些故障阻止将数据库数据写入到数据库的数据文件。然而任何丢失的数据在下一次数据库打开时，ORACLE自动地应用日志文件中的信息来恢复数据库数据文件。

Oralce两种日志文件类型：

 - 联机日志文件  这是Oracle用来循环记录数据库改变的操作系统文件
 - 归档日志文件  这是指为避免联机日志文件重写时丢失重复数据而对联机日志文件所做的备份

## 控制文件
每一ORACLE数据库有一个控制文件(control file)，它记录数据库的物理结构，包含下列信息类型： 
数据库名； 
数据库数据文件和日志文件的名字和位置； 
数据库建立日期。 
为了安全起见，允许控制文件被镜象。 
每一次ORACLE数据库的实例启动时，它的控制文件用于标识数据库和日志文件，当着手数据库操作时它们必须被打开。当数据库的物理组成更改时，ORACLE自动更改该数据库的控制文件。数据恢复时，也要使用控制文件。
## 参数文件
除了构成Oracle数据库物理结构的三类主要文件外，Oracle数据库还具有另外一种重要的文件：参数文件。参数文件记录了Oracle数据库的基本参数信息，主要包括数据库名、控制文件所在路径、进程等。与旧版本的初始化参数文件INITsid.ora不同，在Oracle10g中还可以使用二进进制服务器参数文件，并且该服务器参数文件在安装Oracle数据库系统时由系统自动创建，文件的名称为SPFILEsid.ora，sid为所创建的数据库实例名。 
SPFILEsid.ora中的参数是由Oracle系统自动管理。如果想要对数据库的某些参数进行设置，则可能过OEM或ALTER SYSTEM命令来修改。用户最好不要用编辑器进行修改。

# 实例（instance）
数据库实例（也称为服务器Server）就是用来访问一个数据库文件集的一个存储结构及后台进程的集合。它使一个单独的数据库可以被多个实例访问（也就是ORACLE并行服务器-- OPS）。

实例在操作系统中用ORACLE_SID来标识，在Oracle中用参数INSTANCE_NAME来标识， 它们两个的值是相同的。数据库启动时，系统首先在服务器内存中分配系统全局区（SGA），构成了Oracle的内存结构，然后启动若干个常驻内存的操作系统进程，即组成了Oracle的 进程结构，内存区域和后台进程合称为一个Oracle实例。

![enter description here][7]

PGA与SGA的区别:

　　PGA(程序缓存区)与SGA(系统全局区)类似，都是Oracle数据库系统为会话在服务器内存中分配的区域。不过两者的作用不同，共享程度也
不同。SGA系统全局区顾名思义，是对系统内的所有进程都是共享的。当多个用户同时连接到一个例程时，所有的用户进程、服务进程都可以共
享使用这个SGA区。为此这个SGA的主要用途就是为不同用户之间的进程与服务进程提供一个交流的平台。除了这个作用，另外有一个重要的作
用就是各种数据库的操作主要就是在这个SGA区内完成。
	而PGA程序缓冲区则主要是为了某个用户进程所服务的。这个内存区不是共享的，只有这个用户的服务进程本身才能够访问它自己的PGA区


  [1]: ./images/oracle%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84.gif "oracle体系结构"
  [2]: ./images/luojijiegou.jpg "luojijiegou"
  [3]: ./images/%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84.png "存储结构"
  [4]: ./images/%E5%A6%82%E4%BD%95%E5%AD%98%E5%82%A8%E8%A1%A8%E6%95%B0%E6%8D%AE.png "如何存储表数据"
  [5]: ./images/%E8%A1%A8%E7%A9%BA%E9%97%B4-%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6.png "表空间-数据文件"
  [6]: ./images/%E7%89%A9%E7%90%86%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84.jpg "物理存储结构"
  [7]: ./images/%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BB%93%E6%9E%84%E6%A8%A1%E5%9E%8B.png "服务器结构模型"